<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Securing Admins with Smart Cards (Yubikeys)" /><meta property="og:locale" content="en" /><meta name="description" content="We all know that giving local admin rights to normal users is a big no-no, but what happens if an administrator’s account is compromised? What if a domain admin’s account credentials are obtained? To prevent a potentially catastrophic event, you should use some form of multi-factor authentication to protect those accounts. We all understand that some normal users find difficultly with using multi-factor logins, but as administrators, we don’t really have a choice. The fate of the network is in our hands." /><meta property="og:description" content="We all know that giving local admin rights to normal users is a big no-no, but what happens if an administrator’s account is compromised? What if a domain admin’s account credentials are obtained? To prevent a potentially catastrophic event, you should use some form of multi-factor authentication to protect those accounts. We all understand that some normal users find difficultly with using multi-factor logins, but as administrators, we don’t really have a choice. The fate of the network is in our hands." /><link rel="canonical" href="https://mcnc-clovett.github.io/posts/securing-admins-with-smart-cards-yk/" /><meta property="og:url" content="https://mcnc-clovett.github.io/posts/securing-admins-with-smart-cards-yk/" /><meta property="og:site_name" content="MCNC CNE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-26T00:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Securing Admins with Smart Cards (Yubikeys)" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-22T11:03:04-04:00","datePublished":"2021-03-26T00:00:00-04:00","description":"We all know that giving local admin rights to normal users is a big no-no, but what happens if an administrator’s account is compromised? What if a domain admin’s account credentials are obtained? To prevent a potentially catastrophic event, you should use some form of multi-factor authentication to protect those accounts. We all understand that some normal users find difficultly with using multi-factor logins, but as administrators, we don’t really have a choice. The fate of the network is in our hands.","headline":"Securing Admins with Smart Cards (Yubikeys)","mainEntityOfPage":{"@type":"WebPage","@id":"https://mcnc-clovett.github.io/posts/securing-admins-with-smart-cards-yk/"},"url":"https://mcnc-clovett.github.io/posts/securing-admins-with-smart-cards-yk/"}</script><title>Securing Admins with Smart Cards (Yubikeys) | MCNC CNE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MCNC CNE"><meta name="application-name" content="MCNC CNE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { let self = this;this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { self.clearMode(); } self.notify(); }); if (!this.hasMode) { return; } if (this.isDarkMode) { this.setDark(); } else { this.setLight(); } } get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isPreferDark() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }get modeStatus() { if (this.hasMode) { return this.mode; } else { return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); }notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { this.clearMode(); } else { if (this.isPreferDark) { this.setLight(); } else { this.setDark(); } } this.notify(); } } const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://raw.githubusercontent.com/mcnc-clovett/cdn/master/common/mcnc_cne_300.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">MCNC CNE</a></h1><p class="site-subtitle fst-italic mb-0">Client Network Engineers</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/webinars/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>WEBINARS</span> </a><li class="nav-item"> <a href="/free-tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>FREE TOOLS</span> </a><li class="nav-item"> <a href="/pac-file-code/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>PAC SNIPPETS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mcnc-clovett" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['clovett','mcnc.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Securing Admins with Smart Cards (Yubikeys)</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Securing Admins with Smart Cards (Yubikeys)</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1616731200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 26, 2021 </time> </span> <span> Updated <time data-ts="1655910184" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 22, 2022 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/mcnc-clovett">Chris Lovett</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1222 words" > <em>6 min</em> read</span></div></div></div></header><div class="content"><p>We all know that giving local admin rights to normal users is a <strong>big no-no</strong>, but what happens if an administrator’s account is compromised? What if a domain admin’s account credentials are obtained? To prevent a potentially catastrophic event, you should use some form of multi-factor authentication to protect those accounts. We all understand that some normal users find difficultly with using multi-factor logins, but as administrators, we don’t really have a choice. <em>The fate of the network is in our hands.</em></p><p>One way of providing security is <strong>only using admin credentials when necessary</strong>. Another step on top of that is to use multi-factor authentication. One method that is fairly easy to set up is a smart card implementation. For this example we are going to use the <a href="https://www.yubico.com" target="_blank">Yubikey</a> product, which provides Personal Identity Verification (PIV) functionality. This allows us to store an authentication certificate on a portable key to use to log in to an admin account.</p><h3 id="example-ad-setup"><span class="me-2">Example AD Setup</span><a href="#example-ad-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In our example, the Active Directory structure is as follows:</p><ul><li><strong><em>ad.example.com</em></strong> (Domain Root)<ul><li><strong>Technology</strong> (OU)<ul><li>johndoe (User - Supervisor)<li>admin.johndoe (User - Admin Account)<li><em>Domain Admins</em> (Group)<ul><li><em>admin.johndoe</em></ul><li><em>Enrollment Agents</em> (Group)<ul><li><em>johndoe</em></ul><li><strong>No Logon Local</strong> (OU)<ul><li>admin.billybob (User - Admin Account)<li><em>Local Admins</em> (Group)<ul><li><em>admin.billybob</em></ul></ul></ul></ul></ul><h3 id="install-yubikey-drivers"><span class="me-2">Install Yubikey Drivers</span><a href="#install-yubikey-drivers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Push out, by your preferred method, the driver for your smart cards system-wide. This can be through SCCM, GPO or any other method. An example install script for the <a href="https://www.yubico.com/support/download/smart-card-drivers-tools/" target="_blank">Yubikey Smart Card Minidriver</a> is below. You can also get more information from <a href="https://support.yubico.com/hc/en-us/articles/360015654560-Deploying-the-YubiKey-Minidriver-to-Workstations-and-Servers#Manual-Install" target="_blank">Yubico’s website</a>.</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$installPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\\ad.example.com\SYSVOL\ad.example.com\scripts\yubikey\YubiKey-Minidriver-4.1.1.210-x64.msi"</span><span class="w">
</span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">Get-WmiObject</span><span class="w"> </span><span class="nx">WIN32_PnpSignedDriver</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">DeviceName</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">"YubiKey Smart Card Minidriver"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">DriverVersion</span><span class="w"> </span><span class="o">-ge</span><span class="w"> </span><span class="s2">"4.1.1.210"</span><span class="p">})</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="p">(</span><span class="n">Test-Path</span><span class="w"> </span><span class="nv">$installPath</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">msiexec.exe</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="nv">$installPath</span><span class="w"> </span><span class="nx">INSTALL_LEGACY_NODE</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">/quiet</span><span class="w">
</span><span class="p">}</span><span class="w"> 
</span></pre></table></code></div></div><h3 id="certificate-setup"><span class="me-2">Certificate Setup</span><a href="#certificate-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="create-ca-templates"><span class="me-2">Create CA Templates</span><a href="#create-ca-templates" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li>Add <strong>Enrollment Agents</strong> <em>group</em> to <strong>Read</strong> access on the <strong>Enrollment Agent</strong> <em>template</em><li>Duplicate the <strong>Smartcard Logon</strong> template<ol><li>Under <strong>General</strong> tab:<ul><li>Enter a name for the template (ie. <em>“Yubikey”</em>)<li>Enter a validity period (ie. <em>5 years</em>)<li>Check <strong>Publish certificate in Active Directory</strong><li>Check <strong>Do not automatically reenoll if a duplicate certificate exists in Active Directory</strong></ul><li>Under <strong>Compatibility</strong> tab:<ul><li>Select the OS where the Certificate Authority resides<li>Select the oldest version of Windows in use on the domain</ul><li>Under <strong>Request Handling</strong> tab:<ul><li>For <strong>Purpose</strong>, select <strong>Signature and encryption</strong><li>Check <strong>Include symmetric algorithms allowed by the subject</strong><li>Uncheck <strong>Renew with the same key</strong><li>Check <strong>For automatic renewal of smart card certificates, use the existing key if a new key cannot be created</strong><li>Check <strong>Prompt the user during enrollment</strong></ul><li>Under <strong>Cryptography</strong> tab:<ul><li>For <strong>Provider category</strong>, click the arrow and select <strong>Key Storage Provider</strong> from the dropdown<li>For <strong>Algorithm name</strong>, select either <strong>RSA</strong><li>For <strong>Minimum key size</strong>, enter <strong>2048</strong><li>Check <strong>Requests must use one of the following providers:</strong><li>Under <strong>Providers</strong>, select <strong>Microsoft Smart Card Key Storage Provider</strong><li>Click the arrow for <strong>Request hash</strong> and select <strong>SHA256</strong> from the list displayed</ul><li>Under <strong>Security</strong> tab:<ul><li>For <strong>Group or user names:</strong> Confirm <strong>Authenticated Users</strong> is listed. If is not, click <strong>Add</strong>, enter the name of the group, and then click OK<li>For <strong>Permissions for Authenticated Users</strong>, be sure the option for <strong>Read</strong> is checked<li>Add the <strong>Enrollement Agents</strong> group and check the option for <strong>Read</strong> and <strong>Enroll</strong></ul><li>Under <strong>Issuance Requirements</strong> tab:<ul><li>Check <strong>This number of authorized signatures</strong>, and enter <strong>1</strong><li>For <strong>Policy type required in signature</strong>, select <strong>Application policy</strong><li>For <strong>Application policy</strong>, select <strong>Certificate Request Agent</strong></ul></ol><li>Publish both the Enrollment Agent and new Smartcard Logon (Yubikey) templates to the Certificate Authority</ol><h4 id="create-enrollment-agents"><span class="me-2">Create Enrollment Agents</span><a href="#create-enrollment-agents" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Open <code class="language-plaintext highlighter-rouge">certmgr.msc</code>, and under <strong>Personal\Certificates</strong>:<ol><li>Right click &gt; <strong>All Tasks &gt; Request New Certificate…</strong><li>Click through and select the <strong>Enrollment Agent</strong> template, then click <strong>Enroll</strong></ol></ul><h4 id="enroll-a-user-account-with-a-smart-card"><span class="me-2">Enroll a User Account with a Smart Card</span><a href="#enroll-a-user-account-with-a-smart-card" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Also in <code class="language-plaintext highlighter-rouge">certmgr.msc</code> under <strong>Personal\Certificates</strong>:<ol><li>Right click &gt; <strong>All Tasks &gt; Advanced Operations</strong>, then select <strong>Enroll on Behalf of</strong><li>Click through and select the new smart card template (Yubikey)<li>Type in the user account you want to enroll (<em>admin.johndoe</em>) and click <strong>Enroll</strong><li>Enter the <strong>PIN</strong> for the smart card<li>Open <strong>PowerShell</strong> and enter <code class="language-plaintext highlighter-rouge">certutil -scroots update</code> to add the Enterprise Root Certificate to the smart card</ol></ul><p>You should now be able to login with the admin account (<em>admin.johndoe</em>) by attempting to open a program like PowerShell as administrator. With the Yubikey inserted into the computer, load an application as administrator to bring up the elevation window as shown below. You may need to click on <strong>More choices</strong> to bring up the smart card entry. As you can see, once the smart card is selected, the assigned user is already entered. You now you be able to type in the PIN for the Yubikey and press enter. You should now be running the application as the admin user assigned to the card.</p><p><a href="https://raw.githubusercontent.com/mcnc-clovett/cdn/master/images/card-login.png" class="popup img-link shimmer"><img src="https://raw.githubusercontent.com/mcnc-clovett/cdn/master/images/card-login.png" alt="smart-card-logon" loading="lazy"></a></p><h3 id="set-the-gpos"><span class="me-2">Set the GPOs</span><a href="#set-the-gpos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="set-removal-policy"><span class="me-2">Set Removal Policy</span><a href="#set-removal-policy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Should the user need to step away from a machine or remote desktop session, the session should lock. These settings will ensure the session locks when the smart card is removed.</p><ol><li>Open Group Policy Manager and create a GPO for smart card login at the root of the domain (ie. <em>Smart Card Policy</em>), or use the Default Domain Policy<ol><li>Under <strong>Computer Configuration&gt;Policies&gt;Windows Settings&gt;Security Settings&gt;System Services</strong>:<ul><li>Set <strong>Smart Card Removal Policy</strong> to <strong>Automatic</strong><ul><li><em>(Keep in mind, the service will not auto-start until the device is rebooted. You can also start the service manually if you are unable to reboot a device at the time.)</em></ul></ul><li>Under <strong>Computer Configuration&gt;Policies&gt;Windows Settings&gt;Security Settings&gt;Local Policies&gt;Security Options</strong>:<ul><li>Set <strong>Interactive logon: Smart card removal behavior</strong> to <strong>Disconnect if a remote Remote Desktop Services session</strong></ul></ol></ol><h4 id="set-local-administrators"><span class="me-2">Set Local Administrators</span><a href="#set-local-administrators" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Here we will set what users are allowed to be local administrators domain-wide. Be very selective here and add any other accounts that are absolutely needed. For example, SCCM or other software management groups may need to be added.</p><ol><li>Under <strong>Computer Configuration&gt;Policies&gt;Windows Settings&gt;Security Settings&gt;Restricted Groups</strong>:<ol><li>Right click &gt; <strong>Add Group</strong><li>Enter <strong>Administrators</strong> and click <strong>OK</strong><li>Under <strong>Administrators Properties</strong>, click <strong>Add…</strong>, then add the following:<ul><li>AD\Domain Admins<li>AD\Local Admins<li>Administrator</ul></ol></ol><h3 id="prevent-privileged-users-from-logging-in-directly"><span class="me-2">Prevent Privileged Users from Logging in Directly</span><a href="#prevent-privileged-users-from-logging-in-directly" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You may wish to prevent certain user accounts from logging in to workstations directly, ie. the Windows Logon screen. A good example would be admin accounts. <strong><em>Everyone</em></strong> should be using their normal account to login, and only elevate when permissions are needed for a certain task. Any admin or account that you do wish to login to a workstation or server should <strong>NOT</strong> have this GPO applied.</p><ol><li>Create a new GPO under <strong>Technology\No Logon Local</strong> OU (ie. <em>No Logon Local Policy</em>)<ul><li>* <strong><em>WARNING</em></strong> * <strong>Make sure that you <em>DO NOT</em> create this GPO in the root of the domain. This must only apply to very specific users that should not be able to log in locally. Whoever this GPO applies to will be immediately logged out.</strong></ul><li>Under <strong>User Configuration &gt; Policies &gt; Administrative Templates &gt; System</strong><ol><li>Set <strong>Custom User Interface</strong> to <strong>Enabled</strong>, under <strong>Interface file name</strong> enter <strong>logoff.exe</strong>, click <strong>OK</strong></ol></ol><h3 id="force-privileged-users-to-use-smart-cards"><span class="me-2">Force Privileged Users to Use Smart Cards</span><a href="#force-privileged-users-to-use-smart-cards" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now that you have assigned smart cards to your users, you need to force logins to require the card/key. Once this option is selected for each user, they must use the Yubikey to access the assigned admin account.</p><ol><li>In <strong>Active Directory Users and Computers</strong>, find the users that should only use smart card authentication (<em>admin.johnsmith</em> &amp; <em>admin.billybob</em>)<li>For each user, under their <strong>Account</strong> tab, check <strong>Smart card required for interactive logon</strong></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/security/">Security</a>, <a href="/categories/authentication/">Authentication</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/gpg/" class="post-tag no-text-decoration" >gpg</a> <a href="/tags/gnupg/" class="post-tag no-text-decoration" >gnupg</a> <a href="/tags/pgp/" class="post-tag no-text-decoration" >pgp</a> <a href="/tags/encryption/" class="post-tag no-text-decoration" >encryption</a> <a href="/tags/yubikey/" class="post-tag no-text-decoration" >yubikey</a> <a href="/tags/smartcard/" class="post-tag no-text-decoration" >smartcard</a> <a href="/tags/certificates/" class="post-tag no-text-decoration" >certificates</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >windows</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >powershell</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Securing%20Admins%20with%20Smart%20Cards%20(Yubikeys)%20-%20MCNC%20CNE&url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fsecuring-admins-with-smart-cards-yk%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Securing%20Admins%20with%20Smart%20Cards%20(Yubikeys)%20-%20MCNC%20CNE&u=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fsecuring-admins-with-smart-cards-yk%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fsecuring-admins-with-smart-cards-yk%2F&text=Securing%20Admins%20with%20Smart%20Cards%20(Yubikeys)%20-%20MCNC%20CNE" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fsecuring-admins-with-smart-cards-yk%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/enterprise-sub-ca/">Creating an Enterprise Subordinate CA from an Offline Root CA</a><li class="text-truncate lh-lg"> <a href="/posts/ssl_certificate_management/">SSL Certificate Management</a><li class="text-truncate lh-lg"> <a href="/posts/offline-linux-ca/">Offline Root Certificate Authority - Linux</a><li class="text-truncate lh-lg"> <a href="/posts/allowing-wifi-calling/">Allowing Wifi Calling</a><li class="text-truncate lh-lg"> <a href="/posts/create-domain-join-account/">Creating a Domain Join Account in AD</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/gpg-public-key/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1644379200" data-df="ll" > Feb 8, 2022 </time><h4 class="pt-0 my-2">GnuPG - Encrypting Files with a Public Key</h4><div class="text-muted"><p>Encrypting files or data with a public key is called asymmetric encryption. The benefit to this method is the extra security of encrypting data for a specific recipient. This is done by using the p...</p></div></div></a></article><article class="col"> <a href="/posts/installing-gpg/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637035200" data-df="ll" > Nov 15, 2021 </time><h4 class="pt-0 my-2">GnuPG - Intro & Installation</h4><div class="text-muted"><p>You can skip right to the installation for Windows or macOS. GnuPG is included in all major Linux distributions. Introduction GnuPG or “GNU Privacy Guard” is a free and open source implementation ...</p></div></div></a></article><article class="col"> <a href="/posts/gpg-symmetric/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637035200" data-df="ll" > Nov 15, 2021 </time><h4 class="pt-0 my-2">GnuPG - Encrypting Files with a Password</h4><div class="text-muted"><p>Encrypting files or data with a password is called symmetric encryption. The benefit to this method is the speed of the encryption and decryption process, so it is more suited to large files and da...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/powershell-script-signing/" class="btn btn-outline-primary" aria-label="Older" ><p>PowerShell Script Signing</p></a> <a href="/posts/ssl_certificate_management/" class="btn btn-outline-primary" aria-label="Newer" ><p>SSL Certificate Management</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://github.com/mcnc-clovett">Chris Lovett</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
