<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Offline Root Certificate Authority - Linux" /><meta property="og:locale" content="en" /><meta name="description" content="Every organization that has an Active Directory structure, or any other service that uses SSL/TLS services (ie. HTTPS, RDP, etc.), should have a certificate authority. This certificate authority is used to verify that you are indeed talking directly with the server you think you are and that the connection is secure. Having a certificate authority is also required to enable secure LDAP (LDAPS), though this can also be done with an external certificate authority." /><meta property="og:description" content="Every organization that has an Active Directory structure, or any other service that uses SSL/TLS services (ie. HTTPS, RDP, etc.), should have a certificate authority. This certificate authority is used to verify that you are indeed talking directly with the server you think you are and that the connection is secure. Having a certificate authority is also required to enable secure LDAP (LDAPS), though this can also be done with an external certificate authority." /><link rel="canonical" href="https://mcnc-clovett.github.io/posts/offline-linux-ca/" /><meta property="og:url" content="https://mcnc-clovett.github.io/posts/offline-linux-ca/" /><meta property="og:site_name" content="MCNC CNE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-03T00:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Offline Root Certificate Authority - Linux" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-21T11:15:31-04:00","datePublished":"2022-07-03T00:00:00-04:00","description":"Every organization that has an Active Directory structure, or any other service that uses SSL/TLS services (ie. HTTPS, RDP, etc.), should have a certificate authority. This certificate authority is used to verify that you are indeed talking directly with the server you think you are and that the connection is secure. Having a certificate authority is also required to enable secure LDAP (LDAPS), though this can also be done with an external certificate authority.","headline":"Offline Root Certificate Authority - Linux","mainEntityOfPage":{"@type":"WebPage","@id":"https://mcnc-clovett.github.io/posts/offline-linux-ca/"},"url":"https://mcnc-clovett.github.io/posts/offline-linux-ca/"}</script><title>Offline Root Certificate Authority - Linux | MCNC CNE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MCNC CNE"><meta name="application-name" content="MCNC CNE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { let self = this;this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { self.clearMode(); } self.notify(); }); if (!this.hasMode) { return; } if (this.isDarkMode) { this.setDark(); } else { this.setLight(); } } get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isPreferDark() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }get modeStatus() { if (this.hasMode) { return this.mode; } else { return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); }notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { this.clearMode(); } else { if (this.isPreferDark) { this.setLight(); } else { this.setDark(); } } this.notify(); } } const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://raw.githubusercontent.com/mcnc-clovett/cdn/master/common/mcnc_cne_300.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">MCNC CNE</a></h1><p class="site-subtitle fst-italic mb-0">Client Network Engineers</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/webinars/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>WEBINARS</span> </a><li class="nav-item"> <a href="/free-tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>FREE TOOLS</span> </a><li class="nav-item"> <a href="/pac-file-code/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>PAC SNIPPETS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mcnc-clovett" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['clovett','mcnc.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Offline Root Certificate Authority - Linux</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Offline Root Certificate Authority - Linux</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1656820800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 3, 2022 </time> </span> <span> Updated <time data-ts="1692630931" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 21, 2023 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/mcnc-clovett">Chris Lovett</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1623 words" > <em>9 min</em> read</span></div></div></div></header><div class="content"><p>Every organization that has an Active Directory structure, or any other service that uses SSL/TLS services (ie. HTTPS, RDP, etc.), should have a certificate authority. This certificate authority is used to verify that you are indeed talking directly with the server you think you are and that the connection is secure. Having a certificate authority is also required to enable secure LDAP (LDAPS), though this can also be done with an <a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/identity/enable-ldap-over-ssl-3rd-certification-authority" target="_blank">external certificate authority</a>.</p><p>Choosing to host your offline root CA on a Linux-based system, rather than Windows Server, will save you from licensing a server that will rarely be turned on.</p><h2 id="why-have-an-offline-root-ca"><span class="me-2">Why have an <strong>offline</strong> Root CA?</span><a href="#why-have-an-offline-root-ca" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><blockquote><p>If a root CA is in some way compromised (broken into, hacked, stolen, or accessed by an unauthorized or malicious person), then all of the certificates that were issued by that CA are also compromised. Since certificates are used for data protection, identification, and authorization, the compromise of a CA could compromise the security of an entire organizational network. For that reason, many organizations that run internal PKIs install their root CA offline. That is, the CA is never connected to the company network, which makes the root CA an offline root CA. Make sure that you keep all CAs in secure areas with limited access.<sup id="fnref:fn-rootCA" role="doc-noteref"><a href="#fn:fn-rootCA" class="footnote" rel="footnote">1</a></sup> <br /><br /> <em>– Microsoft TechNet</em></p></blockquote><h2 id="system-requirements"><span class="me-2">System Requirements</span><a href="#system-requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Linux-based, single-purpose physical server<ul><li>You will need to be able to transfer files to and from this device via USB drive.<li>We’ll be using Ubuntu 22.04 LTS Server for this example.<li>This system will be used as an offline root CA, therefore it will be powered off after we’re done.</ul><li>USB drive formatted with ExFAT or FAT32 file system</ul><h2 id="ensure-openssl-is-installed"><span class="me-2">Ensure OpenSSL is Installed</span><a href="#ensure-openssl-is-installed" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Update the server<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt dist-upgrade <span class="nt">-y</span>
</pre></table></code></div></div><li>Install OpenSSL <em>(likely already installed)</em><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> openssl
</pre></table></code></div></div></ol><hr /><blockquote class="prompt-warning"><p>At this point, there is no need for the server to be connected to the network. You should remove the network cable from the ethernet port. If this is a device with a wireless card, ensure it is not connected to the wireless or even remove the WLAN card.</p></blockquote><hr /><h2 id="create-certificate-authority-directory-structure"><span class="me-2">Create Certificate Authority Directory Structure</span><a href="#create-certificate-authority-directory-structure" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Create all directories that will be needed<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nb">cd</span> /etc/ssl
<span class="nb">sudo mkdir</span> <span class="nt">-p</span> root-ca/<span class="o">{</span>private,newcerts,certs,crl,csr<span class="o">}</span>
<span class="nb">sudo chmod </span>700 root-ca/private
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">-p</code> Create the parent directories if they don’t exist<li><code class="language-plaintext highlighter-rouge">700</code> Set the permissions so that only the file owner can read/write <code class="language-plaintext highlighter-rouge">(rwx------)</code></ul><li>Create needed database files<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">cd </span>root-ca
<span class="nb">sudo </span>openssl rand <span class="nt">-out</span> serial <span class="nt">-hex</span> 16
<span class="nb">sudo </span>openssl rand <span class="nt">-out</span> crlnumber <span class="nt">-hex</span> 16
<span class="nb">sudo touch </span>index
</pre></table></code></div></div><li>Create the configuration file</ol><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
</pre><td class="rouge-code"><pre><span class="nb">sudo echo</span> <span class="s1">'[ca]
#/etc/ssl/root-ca/openssl.cnf
#see man ca
default_ca                      = CA_default

[CA_default]
dir                             = /etc/ssl/root-ca
certs                           = $dir/certs
crl_dir                         = $dir/crl
new_certs_dir                   = $dir/newcerts
database                        = $dir/index
serial                          = $dir/serial
RANDFILE                        = $dir/private/.rand

private_key                     = $dir/private/ca.key
certificate                     = $dir/certs/ca.crt

crlnumber                       = $dir/crlnumber
crl                             = $dir/crl/ca.crl
crl_extensions                  = crl_ext
default_crl_days                = 397

default_md                      = sha256

name_opt                        = ca_default
cert_opt                        = ca_default
default_days                    = 397
preserve                        = no
policy                          = policy_loose

[ policy_strict ]
countryName                     = match
stateOrProvinceName             = match
organizationName                = match
organizationalUnitName          = optional
commonName                      = supplied
emailAddress                    = optional

[ policy_loose ]
countryName                     = optional
stateOrProvinceName             = optional
localityName                    = optional
organizationName                = optional
organizationalUnitName          = optional
commonName                      = supplied
emailAddress                    = optional

[ req ]
# Options for the req tool, man req.
default_bits                    = 2048
distinguished_name              = req_distinguished_name
string_mask                     = utf8only
default_md                      = sha256
# Extension to add when the -x509 option is used.
x509_extensions                 = v3_ca

[ req_distinguished_name ]
countryName                     = Country Name (2 letter code)
stateOrProvinceName             = State or Province Name
localityName                    = Locality Name (City or Town)
0.organizationName              = Organization Name (Company Name)
organizationalUnitName          = Organizational Unit Name (Department)
commonName                      = Common Name (Descriptive Name)
emailAddress                    = Email Address

[ v3_ca ]
# Extensions to apply when createing root ca
# Extensions for a typical CA, man x509v3_config
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid:always,issuer
basicConstraints                = critical, CA:true
keyUsage                        = critical, digitalSignature, cRLSign, keyCertSign

[ v3_intermediate_ca ]
# Extensions to apply when creating intermediate or sub-ca
# Extensions for a typical intermediate CA, same man as above
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid:always,issuer
# pathlen:0 ensures no more sub-ca can be created below an intermediate
basicConstraints                = critical, CA:true, pathlen:0
keyUsage                        = critical, digitalSignature, cRLSign, keyCertSign

[ server_cert ]
# Extensions for server certificates
basicConstraints                = CA:FALSE
nsCertType                      = server
nsComment                       = "OpenSSL Generated Server Certificate"
subjectKeyIdentifier            = hash
authorityKeyIdentifier          = keyid,issuer:always
keyUsage                        = critical, digitalSignature, keyEncipherment
extendedKeyUsage                = serverAuth

[ crl_ext ]
# CRL extensions.
# Only issuerAltName and authorityKeyIdentifier make any sense in a CRL.
authorityKeyIdentifier=keyid:always'</span> | <span class="nb">sudo tee </span>openssl.cnf
</pre></table></code></div></div><h2 id="create-the-root-ca-certificate"><span class="me-2">Create the Root CA Certificate</span><a href="#create-the-root-ca-certificate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Generate the new private key and certificate for the root CA<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>openssl req <span class="nt">-new</span> <span class="nt">-newkey</span> rsa:4096 <span class="nt">-x509</span> <span class="nt">-config</span> /etc/ssl/root-ca/openssl.cnf <span class="nt">-extensions</span> v3_ca <span class="nt">-days</span> 7300 <span class="nt">-out</span> certs/ca.crt <span class="nt">-keyout</span> private/ca.key
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">req</code> This is a certificate request<li><code class="language-plaintext highlighter-rouge">-new</code> This is a new request for a certificate<li><code class="language-plaintext highlighter-rouge">-newkey</code> The new private key will be a 4096-bit <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)" target="_blank">RSA</a> key<li><code class="language-plaintext highlighter-rouge">-x509</code> Generate a certificate (self-signed) instead of a certificate request<li><code class="language-plaintext highlighter-rouge">-config</code> Location of the config file to use<li><code class="language-plaintext highlighter-rouge">-extensions</code> Name of the extention to use (defined in the config file)<li><code class="language-plaintext highlighter-rouge">-days</code> Length of certificate life in days (7300 days = 20 years)<li><code class="language-plaintext highlighter-rouge">-out</code> Location of the new root CA certificate file<li><code class="language-plaintext highlighter-rouge">-keyout</code> Location of the private key file for the root CA <strong><em>(Keep this safe!)</em></strong></ul><li>Provide a password for the new root CA key <strong><em>(document this)</em></strong> and provide DN information. Only the Common Name field is required, but all are recommended.<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
<span class="nt">-----</span>
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter <span class="s1">'.'</span>, the field will be left blank.
<span class="nt">-----</span>
Country Name <span class="o">(</span>2 letter code<span class="o">)</span> <span class="o">[]</span>:US
State or Province Name <span class="o">[]</span>:Full State Name
Locality Name <span class="o">(</span>City or Town<span class="o">)</span> <span class="o">[]</span>:Your city
Organization Name <span class="o">(</span>Company Name<span class="o">)</span> <span class="o">[]</span>:Your Organization Name
Organizational Unit Name <span class="o">(</span>Department<span class="o">)</span> <span class="o">[]</span>:Your Department Name
Common Name <span class="o">(</span>Descriptive Name<span class="o">)</span> <span class="o">[]</span>:Your Org Root CA
Email Address <span class="o">[]</span>:
</pre></table></code></div></div><blockquote class="prompt-danger"><p>Do not lose the <code class="language-plaintext highlighter-rouge">ca.key</code> file <strong>or the password to it</strong></p></blockquote><li>Review the certificate you’ve created.<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>openssl x509 <span class="nt">-in</span> certs/ca.crt <span class="nt">-text</span> <span class="nt">-noout</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">x509</code> This is a x509 certificate operation<li><code class="language-plaintext highlighter-rouge">-in</code> The certficate file we’re examining<li><code class="language-plaintext highlighter-rouge">-text</code> Display the certificate in text form<li><code class="language-plaintext highlighter-rouge">-noout</code> Don’t display the certificate in base64 form</ul></ol><ul><li>The output of the above command should look similar to this:<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>Certificate:
  Data:
      Version: 3 (0x2)
      Serial Number:
          2b:06:96:df:af:57:e8:c4:5e:74:0a:fc:24:c4:da:88:ae:42:21:a3
      Signature Algorithm: sha256WithRSAEncryption
      Issuer: C = US, ST = North Carolina, L = RTP, O = MCNC, OU = CNE, CN = MCNC Root CA
      Validity
          Not Before: Jul  3 22:43:56 2022 GMT
          Not After : Jun 28 22:43:56 2042 GMT
      Subject: C = US, ST = North Carolina, L = RTP, O = MCNC, OU = CNE, CN = MCNC Root CA
      Subject Public Key Info:
          Public Key Algorithm: rsaEncryption
              Public-Key: (4096 bit)
              Modulus:
                  00:9c:2b:3f:e5:02:ee:4c:f4:ba:61:07:f0:63:a7:
                  f7:30:26:5f:32:af:c8:38:20:93:1d:62:35:98:5e:
                  20:d4:17:e1:3f:db:86:c8:99:e3:69:75:1c:d2:99:
                  ...
</pre></table></code></div></div></ul><h2 id="generate-the-certificate-revocation-list"><span class="me-2">Generate the Certificate Revocation List</span><a href="#generate-the-certificate-revocation-list" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Create the CRL and sign it using the root CA private<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>openssl ca <span class="nt">-config</span> /etc/ssl/root-ca/openssl.cnf <span class="nt">-gencrl</span> <span class="nt">-out</span> crl/ca.crl
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">ca</code> This CA operation<li><code class="language-plaintext highlighter-rouge">-config</code> Location of the config file to use<li><code class="language-plaintext highlighter-rouge">-gencrl</code> Generate a certificate revocation list signed by the private key<li><code class="language-plaintext highlighter-rouge">-out</code> File to save the CRL to</ul><li>You will be asked to provide the password for the root CA private key<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Using configuration from /etc/ssl/root-ca/openssl.cnf
Enter pass phrase for /etc/ssl/root-ca/private/ca.key:
</pre></table></code></div></div></ol><h2 id="copy-the-root-ca-certificate-and-crl-from-the-server"><span class="me-2">Copy the Root CA Certificate and CRL from the Server</span><a href="#copy-the-root-ca-certificate-and-crl-from-the-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>Insert your USB drive<li>Find the path to your device (all devices in Linux are represented by files)<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>sfdisk <span class="nt">-l</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">-l</code> List all devices</ul><li>My device was <code class="language-plaintext highlighter-rouge">/dev/sdb1</code><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> Disk /dev/sdb: 7.52 GiB, 8058306560 bytes, 15738880 sectors
 Disk model: USB Disk        
 Units: sectors of 1 * 512 = 512 bytes
 Sector size (logical/physical): 512 bytes / 512 bytes
 I/O size (minimum/optimal): 512 bytes / 512 bytes
 Disklabel type: gpt
 Disk identifier: 730CBDED-473E-4991-9AF8-A6910A72F498

 Device     Start      End  Sectors  Size Type
 /dev/sdb1   2048 15736831 15734784  7.5G Microsoft basic data
</pre></table></code></div></div><li>Mount the USB Drive to the <code class="language-plaintext highlighter-rouge">/media</code> directory<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>mount /dev/sdb1 /media
</pre></table></code></div></div><li>Copy the root CA certificate and CRL to the drive<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo cp</span> /etc/ssl/root-ca/certs/ca.crt /etc/ssl/root-ca/crl/ca.crl /media
</pre></table></code></div></div><li>Unmount the USB drive <strong>before</strong> removing it<div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>umount /media
</pre></table></code></div></div><blockquote class="prompt-tip"><p>If creating a Windows Enterprise Subordinate CA, you will need both the <code class="language-plaintext highlighter-rouge">ca.crl</code> and <code class="language-plaintext highlighter-rouge">ca.crt</code> files to import into Active Directory</p></blockquote></ol><h2 id="shutdown-and-store-the-machine"><span class="me-2">Shutdown and Store the Machine</span><a href="#shutdown-and-store-the-machine" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>You may now shutdown the server and store it. The only times the server will be needed are when you stand up a new subordinate (intermediate) certificate authority, or when a sub-CA needs its certificate renewed. Sub-CA’s should renew their certificates every ten years or so.</p><h2 id="footnotes"><span class="me-2">Footnotes</span><a href="#footnotes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="footnotes" role="doc-endnotes"><ol><li id="fn:fn-rootCA" role="doc-endnote"><p><a href="https://social.technet.microsoft.com/wiki/contents/articles/2900.offline-root-certification-authority-ca.aspx">https://social.technet.microsoft.com/wiki/contents/articles/2900.offline-root-certification-authority-ca.aspx</a> <a href="#fnref:fn-rootCA" class="reversefootnote" role="doc-backlink">&#8617;</a></p></ol></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/services/">Services</a>, <a href="/categories/certificate-authorities/">Certificate Authorities</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/certificate/" class="post-tag no-text-decoration" >certificate</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Offline%20Root%20Certificate%20Authority%20-%20Linux%20-%20MCNC%20CNE&url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Foffline-linux-ca%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Offline%20Root%20Certificate%20Authority%20-%20Linux%20-%20MCNC%20CNE&u=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Foffline-linux-ca%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Foffline-linux-ca%2F&text=Offline%20Root%20Certificate%20Authority%20-%20Linux%20-%20MCNC%20CNE" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Foffline-linux-ca%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/enterprise-sub-ca/">Creating an Enterprise Subordinate CA from an Offline Root CA</a><li class="text-truncate lh-lg"> <a href="/posts/ssl_certificate_management/">SSL Certificate Management</a><li class="text-truncate lh-lg"> <a href="/posts/offline-linux-ca/">Offline Root Certificate Authority - Linux</a><li class="text-truncate lh-lg"> <a href="/posts/allowing-wifi-calling/">Allowing Wifi Calling</a><li class="text-truncate lh-lg"> <a href="/posts/create-domain-join-account/">Creating a Domain Join Account in AD</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/enterprise-sub-ca/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1656907200" data-df="ll" > Jul 4, 2022 </time><h4 class="pt-0 my-2">Creating an Enterprise Subordinate CA from an Offline Root CA</h4><div class="text-muted"><p>Every organization that has an Active Directory structure, or any other service that uses SSL/TLS services (ie. HTTPS, RDP, etc.), should have a certificate authority. This certificate authority is...</p></div></div></a></article><article class="col"> <a href="/posts/offline-windows-ca/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1656820800" data-df="ll" > Jul 3, 2022 </time><h4 class="pt-0 my-2">Offline Root Certificate Authority - Windows Server</h4><div class="text-muted"><p>Every organization that has an Active Directory structure, or any other service that uses SSL/TLS services (ie. HTTPS, RDP, etc.), should have a certificate authority. This certificate authority is...</p></div></div></a></article><article class="col"> <a href="/posts/publish-rdp-certs/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1656907200" data-df="ll" > Jul 4, 2022 </time><h4 class="pt-0 my-2">Publishing Remote Desktop Certificates</h4><div class="text-muted"><p>While extremely convenient, the Remote Desktop Protocol can be extremely dangerous if not secured correctly. Typical things you should consider are ACLs, firewall rules, smart cards, RDP Gateways, ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/linux-based-sftp-server/" class="btn btn-outline-primary" aria-label="Older" ><p>Linux-based SFTP Server</p></a> <a href="/posts/offline-windows-ca/" class="btn btn-outline-primary" aria-label="Newer" ><p>Offline Root Certificate Authority - Windows Server</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://github.com/mcnc-clovett">Chris Lovett</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
