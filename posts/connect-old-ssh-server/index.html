<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Connecting to Old SSH Servers" /><meta property="og:locale" content="en" /><meta name="description" content="Unable to negotiate with 192.0.2.1 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1" /><meta property="og:description" content="Unable to negotiate with 192.0.2.1 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1" /><link rel="canonical" href="https://mcnc-clovett.github.io/posts/connect-old-ssh-server/" /><meta property="og:url" content="https://mcnc-clovett.github.io/posts/connect-old-ssh-server/" /><meta property="og:site_name" content="MCNC CNE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-15T00:00:00-04:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Connecting to Old SSH Servers" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-07-15T00:00:00-04:00","datePublished":"2023-07-15T00:00:00-04:00","description":"Unable to negotiate with 192.0.2.1 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1","headline":"Connecting to Old SSH Servers","mainEntityOfPage":{"@type":"WebPage","@id":"https://mcnc-clovett.github.io/posts/connect-old-ssh-server/"},"url":"https://mcnc-clovett.github.io/posts/connect-old-ssh-server/"}</script><title>Connecting to Old SSH Servers | MCNC CNE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MCNC CNE"><meta name="application-name" content="MCNC CNE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { let self = this;this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { self.clearMode(); } self.notify(); }); if (!this.hasMode) { return; } if (this.isDarkMode) { this.setDark(); } else { this.setLight(); } } get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isPreferDark() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }get modeStatus() { if (this.hasMode) { return this.mode; } else { return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); }notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { this.clearMode(); } else { if (this.isPreferDark) { this.setLight(); } else { this.setDark(); } } this.notify(); } } const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://raw.githubusercontent.com/mcnc-clovett/cdn/master/common/mcnc_cne_300.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">MCNC CNE</a></h1><p class="site-subtitle fst-italic mb-0">Client Network Engineers</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/webinars/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>WEBINARS</span> </a><li class="nav-item"> <a href="/free-tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>FREE TOOLS</span> </a><li class="nav-item"> <a href="/pac-file-code/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>PAC SNIPPETS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mcnc-clovett" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['clovett','mcnc.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Connecting to Old SSH Servers</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Connecting to Old SSH Servers</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1689393600" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 15, 2023 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/mcnc-clovett">Chris Lovett</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="930 words" > <em>5 min</em> read</span></div></div></div></header><div class="content"><p><code class="language-plaintext highlighter-rouge">Unable to negotiate with 192.0.2.1 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1</code></p><p>Have you come across an error like this when trying to SSH into a switch or server? It happens when the SSH server and your SSH client disagree on what algorithms they support. By default, newer versions of OpenSSH don’t support older, less secure algorithms. This becomes a more prevalent problem as SSH clients update to newer versions and your switches and servers remain on older ones.</p><p>Don’t worry, though. You can enable support for these algorithms in your SSH client configuration for good!</p><h2 id="configuration-locations"><span class="me-2">Configuration Locations</span><a href="#configuration-locations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>First, lets locate where your SSH client configuration is. This is relatively the same between all operating systems.</p><ul><li><strong>Windows:</strong> <code class="language-plaintext highlighter-rouge">C:\Users\&lt;username&gt;\.ssh\config</code><li><strong>macOS:</strong> <code class="language-plaintext highlighter-rouge">/Users/&lt;username&gt;/.ssh/config</code><li><strong>Linux:</strong> <code class="language-plaintext highlighter-rouge">/home/&lt;username&gt;/.ssh/config</code></ul><p>If this folder and/or file doesn’t exist, you can create them.</p><h3 id="windows-cmdexe"><span class="me-2">Windows (cmd.exe)</span><a href="#windows-cmdexe" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">C:\Users\cne&gt;</span><span class="w"> </span><span class="nb">mkdir</span> %HOMEPATH<span class="se">\.</span>ssh
<span class="gp">C:\Users\cne&gt;</span><span class="w"> </span><span class="nb">cd</span> %HOMEPATH%<span class="se">\.</span>ssh
<span class="gp">C:\Users\cne\.ssh&gt;</span><span class="w"> </span>copy NUL config
<span class="gp">C:\Users\cne\.ssh&gt;</span><span class="w"> </span>notepad config
</pre></table></code></div></div><h3 id="windows-powershell"><span class="me-2">Windows (Powershell)</span><a href="#windows-powershell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">PS C:\Users\cne&gt;</span><span class="w"> </span><span class="nb">mkdir</span> ~<span class="se">\.</span>ssh
<span class="gp">PS C:\Users\cne&gt;</span><span class="w"> </span><span class="nb">cd</span> ~<span class="se">\.</span>ssh
<span class="gp">PS C:\Users\cne&gt;</span><span class="w"> </span>New-Item <span class="nt">-Path</span> config <span class="nt">-ItemType</span> File
<span class="gp">PS C:\Users\cne&gt;</span><span class="w"> </span>notepad config
</pre></table></code></div></div><h3 id="macos"><span class="me-2">macOS</span><a href="#macos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">cne@mcnc ~ %</span><span class="w"> </span><span class="nb">mkdir</span> <span class="nt">-m</span> 700 ~/.ssh
<span class="gp">cne@mcnc ~ %</span><span class="w"> </span><span class="nb">cd</span> ~/.ssh
<span class="gp">cne@mcnc .ssh %</span><span class="w"> </span><span class="nb">touch </span>config
<span class="gp">cne@mcnc .ssh %</span><span class="w"> </span>open config
</pre></table></code></div></div><h3 id="linux"><span class="me-2">Linux</span><a href="#linux" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">cne@mcnc:~$</span><span class="w"> </span><span class="nb">mkdir</span> <span class="nt">-m</span> 700 ~/.ssh
<span class="gp">cne@mcnc:~$</span><span class="w"> </span><span class="nb">cd</span> ~/.ssh
<span class="gp">cne@mcnc:~/.ssh$</span><span class="w"> </span><span class="nb">touch </span>config
<span class="gp">cne@mcnc:~/.ssh$</span><span class="w"> </span>nano config
</pre></table></code></div></div><h2 id="ssh-settings"><span class="me-2">SSH Settings</span><a href="#ssh-settings" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>There are several errors you may run across while connecting to older SSH servers. The most common settings related to these are <code class="language-plaintext highlighter-rouge">KexAlgorithms</code> (key exchange), <code class="language-plaintext highlighter-rouge">HostKeyAlgorithms</code>, <code class="language-plaintext highlighter-rouge">Ciphers</code> and <code class="language-plaintext highlighter-rouge">MACs</code> (message authentication codes).</p><h3 id="kexalgorithms"><span class="me-2">KexAlgorithms</span><a href="#kexalgorithms" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Key echange algorithms are used to exchange the secret key that the SSH server and client will use to encrypt the traffic between them. The error you’ll see is much like this:</p><p><code class="language-plaintext highlighter-rouge">Unable to negotiate with 192.0.2.1 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1</code></p><p>The key words here are <code class="language-plaintext highlighter-rouge">no matching key exchange method found</code>. The server supports the algorithms listed, which you must enable at least one of to communicate with it. You can do this by copying the offers and placing them in your <code class="language-plaintext highlighter-rouge">config</code> file with the configuration name <code class="language-plaintext highlighter-rouge">KexAlgorithms</code> and using the <code class="language-plaintext highlighter-rouge">+</code> to add them. Do <em>NOT</em> forget the <code class="language-plaintext highlighter-rouge">+</code>, or you’ll disable the defaults.</p><div class="language-ssh highlighter-rouge"><div class="code-header"> <span data-label-text="SSH"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">KexAlgorithms</span> +diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
</pre></table></code></div></div><p>You can list all the key exchange algorithms your client supports with <code class="language-plaintext highlighter-rouge">ssh -Q kex</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">C:\Users\cne&gt;</span><span class="w"> </span>ssh <span class="nt">-Q</span> kex
<span class="go">diffie-hellman-group1-sha1
diffie-hellman-group14-sha1
diffie-hellman-group14-sha256
diffie-hellman-group16-sha512
diffie-hellman-group18-sha512
diffie-hellman-group...
</span></pre></table></code></div></div><h3 id="hostkeyalgorithms"><span class="me-2">HostKeyAlgorithms</span><a href="#hostkeyalgorithms" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Host key algorithms specify which host key types that the server supports. The typical error looks something like this:</p><p><code class="language-plaintext highlighter-rouge">Unable to negotiate with 192.0.2.1 port 22: no matching host key type found. Their offer: ssh-rsa</code></p><p>The key words here are <code class="language-plaintext highlighter-rouge">no matching host key type found</code>. The server supports the algorithms listed, which you must enable at least one of to communicate with it. You can do this by copying the offers and placing them in your <code class="language-plaintext highlighter-rouge">config</code> file with the configuration name <code class="language-plaintext highlighter-rouge">HostKeyAlgorithms</code> and using the <code class="language-plaintext highlighter-rouge">+</code> to add them. Do <em>NOT</em> forget the <code class="language-plaintext highlighter-rouge">+</code>, or you’ll disable the defaults.</p><div class="language-ssh highlighter-rouge"><div class="code-header"> <span data-label-text="SSH"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">HostKeyAlgorithms</span> +ssh-rsa
</pre></table></code></div></div><p>You can list all the host key algorithms your client supports with <code class="language-plaintext highlighter-rouge">ssh -Q key</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">C:\Users\cne&gt;</span><span class="w"> </span>ssh <span class="nt">-Q</span> key
<span class="go">ssh-ed25519
ssh-ed25519-cert-v01@openssh.com
ssh-rsa
ssh-dss
ecdsa-sha2-nistp256
ecdsa-sha2-nistp384
ecdsa-sha2-nistp521
ssh-rsa-cert...
</span></pre></table></code></div></div><h3 id="ciphers"><span class="me-2">Ciphers</span><a href="#ciphers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ciphers are used to actually do the encrypting of the traffic between client and server. An error you would see for ciphers is like this:</p><p><code class="language-plaintext highlighter-rouge">Unable to negotiate with 192.0.2.1 port 22: no matching cipher found. Their offer: aes256-cbc,aes192-cbc,aes128-cbc</code></p><p>The key words here are <code class="language-plaintext highlighter-rouge">no matching cipher found</code>. The server supports the ciphers listed, which you must enable at least one of to communicate with it. You can do this by copying the offers and placing them in your <code class="language-plaintext highlighter-rouge">config</code> file with the configuration name <code class="language-plaintext highlighter-rouge">Ciphers</code> and using the <code class="language-plaintext highlighter-rouge">+</code> to add them. Do NOT forget the <code class="language-plaintext highlighter-rouge">+</code>, or you’ll disable the defaults.</p><div class="language-ssh highlighter-rouge"><div class="code-header"> <span data-label-text="SSH"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">Ciphers</span> +aes256-cbc,aes192-cbc,aes128-cbc
</pre></table></code></div></div><p>You can list all the ciphers that your client supports with <code class="language-plaintext highlighter-rouge">ssh -Q cipher</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">C:\Users\cne&gt;</span><span class="w"> </span>ssh <span class="nt">-Q</span> cipher
<span class="go">3des-cbc
aes128-cbc
aes192-cbc
aes256-cbc
aes128-ctr
aes192-ctr
aes256-ctr
aes128-gcm...
</span></pre></table></code></div></div><h3 id="macs"><span class="me-2">MACs</span><a href="#macs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>MACs, or message authentication codes, are used to ensure that data hasn’t been tampered with before they reach their intended recipient. A MAC error looks like this:</p><p><code class="language-plaintext highlighter-rouge">Unable to negotiate with 192.0.2.1 port 22: no matching MAC found. Their offer: hmac-sha1</code></p><p>The key words here are <code class="language-plaintext highlighter-rouge">no matching MAC found</code>. The server supports the MACs listed, which you must enable at least one of to communicate with it. You can do this by copying the offers and placing them in your <code class="language-plaintext highlighter-rouge">config</code> file with the configuration name <code class="language-plaintext highlighter-rouge">MACs</code> and using the <code class="language-plaintext highlighter-rouge">+</code> to add them. Do NOT forget the <code class="language-plaintext highlighter-rouge">+</code>, or you’ll disable the defaults.</p><div class="language-ssh highlighter-rouge"><div class="code-header"> <span data-label-text="SSH"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">MACs</span> +hmac-sha1
</pre></table></code></div></div><p>You can list all the MACs that your client supports with <code class="language-plaintext highlighter-rouge">ssh -Q mac</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">C:\Users\cne&gt;</span><span class="w"> </span>ssh <span class="nt">-Q</span> mac
<span class="go">hmac-sha1
hmac-sha1-96
hmac-sha2-256
hmac-sha2-512
hmac-md5
hmac-md5-96
umac-64@openssh.com
umac-128@openssh.com
hmac-sha1-etm...
</span></pre></table></code></div></div><h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Depending on how old the server is, you may not have to add each of the settings listed here, but they are the most common. The configuration I have to communicate with the server used in this example looks like this:</p><div class="language-ssh highlighter-rouge"><div class="code-header"> <span data-label-text="SSH"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">KexAlgorithms</span> +diffie-hellman-group-exchange-sha1
<span class="k">HostKeyAlgorithms</span> +ssh-rsa
<span class="k">Ciphers</span> +aes256-cbc
</pre></table></code></div></div><p>If you’d like to use these less secure configurations only on certain servers, you can use <code class="language-plaintext highlighter-rouge">Host</code> to list the hosts and/or networks like this:</p><div class="language-ssh highlighter-rouge"><div class="code-header"> <span data-label-text="SSH"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">Host</span> <span class="m">192</span>.0.2.1 <span class="m">192</span>.168.* <span class="m">172</span>.16.0.*
    <span class="k">KexAlgorithms</span> +diffie-hellman-group-exchange-sha1
    <span class="k">HostKeyAlgorithms</span> +ssh-rsa
    <span class="k">Ciphers</span> +aes256-cbc
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/services/">Services</a>, <a href="/categories/ssh-sftp/">SSH / SFTP</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/ssh/" class="post-tag no-text-decoration" >ssh</a> <a href="/tags/cli/" class="post-tag no-text-decoration" >cli</a> <a href="/tags/command-line/" class="post-tag no-text-decoration" >command line</a> <a href="/tags/openssh/" class="post-tag no-text-decoration" >openssh</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Connecting%20to%20Old%20SSH%20Servers%20-%20MCNC%20CNE&url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fconnect-old-ssh-server%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Connecting%20to%20Old%20SSH%20Servers%20-%20MCNC%20CNE&u=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fconnect-old-ssh-server%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fconnect-old-ssh-server%2F&text=Connecting%20to%20Old%20SSH%20Servers%20-%20MCNC%20CNE" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fconnect-old-ssh-server%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/enterprise-sub-ca/">Creating an Enterprise Subordinate CA from an Offline Root CA</a><li class="text-truncate lh-lg"> <a href="/posts/ssl_certificate_management/">SSL Certificate Management</a><li class="text-truncate lh-lg"> <a href="/posts/offline-linux-ca/">Offline Root Certificate Authority - Linux</a><li class="text-truncate lh-lg"> <a href="/posts/allowing-wifi-calling/">Allowing Wifi Calling</a><li class="text-truncate lh-lg"> <a href="/posts/create-domain-join-account/">Creating a Domain Join Account in AD</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/linux-based-sftp-server/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1656648000" data-df="ll" > Jul 1, 2022 </time><h4 class="pt-0 my-2">Linux-based SFTP Server</h4><div class="text-muted"><p>This guide demonstrates the precedure for creating a Linux-based SFTP server using OpenSSH. The end result is an SFTP server only available to the “sftpusers” group via sftp only. SSH shell access ...</p></div></div></a></article><article class="col"> <a href="/posts/windows-based-sftp-server/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1631073600" data-df="ll" > Sep 8, 2021 </time><h4 class="pt-0 my-2">Windows-based SFTP Server</h4><div class="text-muted"><p>This guide demonstrates the precedure for creating a Windows-based SFTP server using the built-in OpenSSH instance. The end result is an SFTP server only available to the “sftpusers” group via sftp...</p></div></div></a></article><article class="col"> <a href="/posts/publish-rdp-certs/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1656907200" data-df="ll" > Jul 4, 2022 </time><h4 class="pt-0 my-2">Publishing Remote Desktop Certificates</h4><div class="text-muted"><p>While extremely convenient, the Remote Desktop Protocol can be extremely dangerous if not secured correctly. Typical things you should consider are ACLs, firewall rules, smart cards, RDP Gateways, ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/publish-rdp-certs/" class="btn btn-outline-primary" aria-label="Older" ><p>Publishing Remote Desktop Certificates</p></a> <a href="/posts/create-domain-join-account/" class="btn btn-outline-primary" aria-label="Newer" ><p>Creating a Domain Join Account in AD</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://github.com/mcnc-clovett">Chris Lovett</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
