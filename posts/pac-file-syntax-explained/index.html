<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="PAC File Syntax Explained" /><meta property="og:locale" content="en" /><meta name="description" content="PAC files can seem a bit complicated at first, but keep in mind that they are just a javascript function with only two inputs. We’ll be going over an example PAC file and discussing what each section does, as well as the correct syntax. Proper syntax is important, as making a slight mistake, like a misplaced semicolon, can cause the entire script to fail and no traffic to be proxied. For a full and comprehensive description of all available PAC file functions, check out Mozilla’s documentation." /><meta property="og:description" content="PAC files can seem a bit complicated at first, but keep in mind that they are just a javascript function with only two inputs. We’ll be going over an example PAC file and discussing what each section does, as well as the correct syntax. Proper syntax is important, as making a slight mistake, like a misplaced semicolon, can cause the entire script to fail and no traffic to be proxied. For a full and comprehensive description of all available PAC file functions, check out Mozilla’s documentation." /><link rel="canonical" href="https://mcnc-clovett.github.io/posts/pac-file-syntax-explained/" /><meta property="og:url" content="https://mcnc-clovett.github.io/posts/pac-file-syntax-explained/" /><meta property="og:site_name" content="MCNC CNE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-15T23:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PAC File Syntax Explained" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-19T15:17:19-04:00","datePublished":"2020-12-15T23:00:00-05:00","description":"PAC files can seem a bit complicated at first, but keep in mind that they are just a javascript function with only two inputs. We’ll be going over an example PAC file and discussing what each section does, as well as the correct syntax. Proper syntax is important, as making a slight mistake, like a misplaced semicolon, can cause the entire script to fail and no traffic to be proxied. For a full and comprehensive description of all available PAC file functions, check out Mozilla’s documentation.","headline":"PAC File Syntax Explained","mainEntityOfPage":{"@type":"WebPage","@id":"https://mcnc-clovett.github.io/posts/pac-file-syntax-explained/"},"url":"https://mcnc-clovett.github.io/posts/pac-file-syntax-explained/"}</script><title>PAC File Syntax Explained | MCNC CNE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MCNC CNE"><meta name="application-name" content="MCNC CNE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { let self = this;this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { self.clearMode(); } self.notify(); }); if (!this.hasMode) { return; } if (this.isDarkMode) { this.setDark(); } else { this.setLight(); } } get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isPreferDark() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }get modeStatus() { if (this.hasMode) { return this.mode; } else { return this.isPreferDark ? ModeToggle.DARK_MODE : ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); }notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { this.clearMode(); } else { if (this.isPreferDark) { this.setLight(); } else { this.setDark(); } } this.notify(); } } const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://raw.githubusercontent.com/mcnc-clovett/cdn/master/common/mcnc_cne_300.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">MCNC CNE</a></h1><p class="site-subtitle fst-italic mb-0">Client Network Engineers</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/webinars/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>WEBINARS</span> </a><li class="nav-item"> <a href="/free-tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>FREE TOOLS</span> </a><li class="nav-item"> <a href="/pac-file-code/" class="nav-link"> <i class="fa-fw fas fa-code"></i> <span>PAC SNIPPETS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mcnc-clovett" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['clovett','mcnc.org'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>PAC File Syntax Explained</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>PAC File Syntax Explained</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1608091200" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 15, 2020 </time> </span> <span> Updated <time data-ts="1650395839" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 19, 2022 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/mcnc-clovett">Chris Lovett</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1215 words" > <em>6 min</em> read</span></div></div></div></header><div class="content"><p>PAC files can seem a bit complicated at first, but keep in mind that they are just a javascript function with only two inputs. We’ll be going over an example PAC file and discussing what each section does, as well as the correct syntax. Proper syntax is important, as making a slight mistake, like a misplaced semicolon, can cause the entire script to fail and <strong>no traffic to be proxied</strong>. For a full and comprehensive description of all available PAC file functions, check out <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Proxy_servers_and_tunneling/Proxy_Auto-Configuration_(PAC)_file" target="_blank">Mozilla’s documentation</a>.</p><p>For the NCREN community that uses Zscaler, there is a “Verify” button that can be used to check the validity of your code. Keep in mind that this doesn’t always catch problems in the syntax and you should <strong>always</strong> verify that your traffic is being proxied correctly after making a change.</p><p>The PAC file below is the example we’ll be dicussing:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">FindProxyForURL</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">host</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">.</span><span class="dl">"</span><span class="o">+</span><span class="nx">host</span><span class="p">.</span><span class="nf">toLowerCase</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">privateIP</span> <span class="o">=</span> <span class="sr">/^</span><span class="se">(</span><span class="sr">0|10|127|192</span><span class="se">\.</span><span class="sr">168|172</span><span class="se">\.</span><span class="sr">1</span><span class="se">[</span><span class="sr">6789</span><span class="se">]</span><span class="sr">|172</span><span class="se">\.</span><span class="sr">2</span><span class="se">[</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">|172</span><span class="se">\.</span><span class="sr">3</span><span class="se">[</span><span class="sr">01</span><span class="se">]</span><span class="sr">|169</span><span class="se">\.</span><span class="sr">254|192</span><span class="se">\.</span><span class="sr">88</span><span class="se">\.</span><span class="sr">99</span><span class="se">)\.[</span><span class="sr">0-9.</span><span class="se">]</span><span class="sr">+$/</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">resolved_ip</span> <span class="o">=</span> <span class="nf">dnsResolve</span><span class="p">(</span><span class="nx">host</span><span class="p">);</span>
    
    <span class="cm">/* If local server is resolvable to the correct address, go directly out */</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">dnsResolve</span><span class="p">(</span><span class="dl">"</span><span class="s2">internalserver.example.net</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">192.168.0.5</span><span class="dl">"</span> <span class="p">)</span>
        <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span> 

    <span class="cm">/* Don't send non-FQDN or private IP auths to us */</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">isPlainHostName</span><span class="p">(</span><span class="nx">host</span><span class="p">)</span> <span class="o">||</span> <span class="nf">isInNet</span><span class="p">(</span><span class="nx">resolved_ip</span><span class="p">,</span> <span class="dl">"</span><span class="s2">192.0.2.0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">255.255.255.0</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span> <span class="nx">privateIP</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">resolved_ip</span><span class="p">))</span>
        <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>

    <span class="cm">/* Some example host bypasses */</span>
    <span class="cm">/* Single statement - complicated but faster on device */</span>
    <span class="k">if </span><span class="p">(</span>
        <span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.com</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span>
        <span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.org</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span>
        <span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">sub.example.net</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">)</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
    <span class="cm">/* Multiple statements  - easier but slower on device */</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.com</span><span class="dl">"</span><span class="p">))</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.org</span><span class="dl">"</span><span class="p">))</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">sub.example.net</span><span class="dl">"</span><span class="p">))</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
    
     <span class="cm">/* Default Traffic Forwarding. */</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">PROXY node1.example.com:9443; PROXY node2.example.com:9443</span><span class="dl">"</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><hr /><h3 id="the-heading"><span class="me-2">The Heading</span><a href="#the-heading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">FindProxyForURL</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">host</span><span class="p">)</span> <span class="p">{</span>
</pre></table></code></div></div><p>This first section is the start of the function that the browser runs when making a request for a web site. As you see below, there are two variables fed to the PAC file. They are <code class="language-plaintext highlighter-rouge">url</code> and <code class="language-plaintext highlighter-rouge">host</code>. As of Chrome 75 (and it’s derivatives), these variables contain the following values given a URL such as <code class="language-plaintext highlighter-rouge">https://www.example.com/some/path/index.html</code>:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>url  = https://www.example.com/
host = www.example.com
</pre></table></code></div></div><p>Notice there is no path information in the <code class="language-plaintext highlighter-rouge">url</code> variable. This is because <a href="https://chromium.googlesource.com/chromium/src/+/HEAD/net/docs/proxy.md#Arguments-passed-to-FindProxyForURL_in-PAC-scripts" target="_blank">Google determined</a> this to be a security vulnerability and removed this information from PAC files. This means you are unable to use path information to direct traffic, and using paths will likely prevent your rules from working.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">host</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">.</span><span class="dl">"</span><span class="o">+</span><span class="nx">host</span><span class="p">.</span><span class="nf">toLowerCase</span><span class="p">();</span>
</pre></table></code></div></div><p>This line is modifying the <code class="language-plaintext highlighter-rouge">host</code> variable. The <code class="language-plaintext highlighter-rouge">host.toLowerCase()</code> portion converts the <code class="language-plaintext highlighter-rouge">host</code> to all lowercase characters to ensure consistent matching later on in the PAC file. In other words, <code class="language-plaintext highlighter-rouge">www.Example.com</code> will become <code class="language-plaintext highlighter-rouge">www.example.com</code>.</p><p>Adding the <code class="language-plaintext highlighter-rouge">"."+</code> will prepend a dot to the <code class="language-plaintext highlighter-rouge">host</code>, which is a trick to prevent the need for entries for both <code class="language-plaintext highlighter-rouge">example.com</code> and <code class="language-plaintext highlighter-rouge">.example.com</code> in favor of just <code class="language-plaintext highlighter-rouge">.example.com</code>.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">privateIP</span> <span class="o">=</span> <span class="sr">/^</span><span class="se">(</span><span class="sr">0|10|127|192</span><span class="se">\.</span><span class="sr">168|172</span><span class="se">\.</span><span class="sr">1</span><span class="se">[</span><span class="sr">6789</span><span class="se">]</span><span class="sr">|172</span><span class="se">\.</span><span class="sr">2</span><span class="se">[</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">|172</span><span class="se">\.</span><span class="sr">3</span><span class="se">[</span><span class="sr">01</span><span class="se">]</span><span class="sr">|169</span><span class="se">\.</span><span class="sr">254|192</span><span class="se">\.</span><span class="sr">88</span><span class="se">\.</span><span class="sr">99</span><span class="se">)\.[</span><span class="sr">0-9.</span><span class="se">]</span><span class="sr">+$/</span><span class="p">;</span>
</pre></table></code></div></div><p>This line creates a variable called <code class="language-plaintext highlighter-rouge">privateIP</code> for several IP ranges that should not be proxied. These are <code class="language-plaintext highlighter-rouge">0.0.0.0</code>, <code class="language-plaintext highlighter-rouge">10.0.0.0/8</code>, <code class="language-plaintext highlighter-rouge">127.0.0.0/8</code>, <code class="language-plaintext highlighter-rouge">192.168.0.0/16</code>, <code class="language-plaintext highlighter-rouge">172.16.0.0/12</code>, <code class="language-plaintext highlighter-rouge">169.254.0.0/16</code> &amp; <code class="language-plaintext highlighter-rouge">192.88.99.0/24</code>.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">resolved_ip</span> <span class="o">=</span> <span class="nf">dnsResolve</span><span class="p">(</span><span class="nx">host</span><span class="p">);</span>
</pre></table></code></div></div><p>This line creates a variable called <code class="language-plaintext highlighter-rouge">resolved_ip</code> that contains the IP address of the site you’re trying to reach.</p><hr /><h3 id="location-awareness"><span class="me-2">Location Awareness</span><a href="#location-awareness" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cm">/* If local server is resolvable to the correct address, go directly out */</span>
<span class="k">if </span><span class="p">(</span><span class="nf">dnsResolve</span><span class="p">(</span><span class="dl">"</span><span class="s2">localsrv.ad.example.net</span><span class="dl">"</span><span class="p">)</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">192.168.0.5</span><span class="dl">"</span> <span class="p">)</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span> 
</pre></table></code></div></div><p>This block uses the <code class="language-plaintext highlighter-rouge">dnsResolve()</code> function to determine the IP address of <code class="language-plaintext highlighter-rouge">localsrv.ad.example.net</code> and find if it equals the provided value of <code class="language-plaintext highlighter-rouge">192.168.0.5</code>. If it does match, the traffic goes directly to the internet. This can be used with local DNS to test whether the client is on you network or not. If the client is off your network, naturally the hostanme will not resolve and the rest of the PAC file will be processed. It’s best to put your location aware section above your exclusion list. This will avoid needlessly processing a long list of exclusions when the device is on-site.</p><hr /><h3 id="send-local-traffic-direct"><span class="me-2">Send Local Traffic DIRECT</span><a href="#send-local-traffic-direct" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="cm">/* Don't send non-FQDN or private IP auths to us */</span>
<span class="k">if </span><span class="p">(</span><span class="nf">isPlainHostName</span><span class="p">(</span><span class="nx">host</span><span class="p">)</span> <span class="o">||</span> <span class="nf">isInNet</span><span class="p">(</span><span class="nx">resolved_ip</span><span class="p">,</span> <span class="dl">"</span><span class="s2">192.0.2.0</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">255.255.255.0</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span> <span class="nx">privateIP</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">resolved_ip</span><span class="p">))</span>
    <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
</pre></table></code></div></div><p>This block tests for three different things, seperated by double pipes (<code class="language-plaintext highlighter-rouge">||</code>). The double pipe means <code class="language-plaintext highlighter-rouge">or</code>. <code class="language-plaintext highlighter-rouge">isPlainHostName(host)</code> tests if <code class="language-plaintext highlighter-rouge">host</code> is a simple hostname like <code class="language-plaintext highlighter-rouge">example-dc</code> or <code class="language-plaintext highlighter-rouge">localhost</code>. Next, <code class="language-plaintext highlighter-rouge">isInNet(resolved_ip, "192.0.2.0","255.255.255.0")</code> will test if the destination is in the 192.0.2.0/24 network. Lastly, <code class="language-plaintext highlighter-rouge">privateIP.test(resolved_ip)</code> tests whether the IP address of the destination matches the regular expression in the <code class="language-plaintext highlighter-rouge">privateIP</code> variable we dicussed earlier.</p><hr /><h3 id="exclusions-from-proxy"><span class="me-2">Exclusions from PROXY</span><a href="#exclusions-from-proxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="cm">/* Some example host bypasses */</span>
<span class="cm">/* Single statement - complicated but faster on device */</span>
<span class="k">if </span><span class="p">(</span>
    <span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.com</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span>
    <span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.org</span><span class="dl">"</span><span class="p">)</span> <span class="o">||</span>
    <span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">sub.example.net</span><span class="dl">"</span><span class="p">)</span>
<span class="p">)</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
</pre></table></code></div></div><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="cm">/* Multiple statements  - easier but slower on device */</span>
<span class="k">if </span><span class="p">(</span><span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.com</span><span class="dl">"</span><span class="p">))</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
<span class="k">if </span><span class="p">(</span><span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.example.org</span><span class="dl">"</span><span class="p">))</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
<span class="k">if </span><span class="p">(</span><span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">sub.example.net</span><span class="dl">"</span><span class="p">))</span> <span class="k">return</span> <span class="dl">"</span><span class="s2">DIRECT</span><span class="dl">"</span><span class="p">;</span>
</pre></table></code></div></div><p>Now for the section you’ll have the most interaction with. This is where you place your rules for the various sites you wish not to be proxied. The above two blocks result in the <strong>exact</strong> same outcome. The difference is that the latter is more CPU intensive than the former. Its recommended to use whichever you are more comfortable with managing.</p><p>In the first example, each test is separated by double pipes (<code class="language-plaintext highlighter-rouge">||</code>), which means <code class="language-plaintext highlighter-rouge">or</code>. The second exmaple places each test in its own statement on a seperate line.</p><p>The <code class="language-plaintext highlighter-rouge">dnsDomainIs()</code> function works by testing if the given string, such as <code class="language-plaintext highlighter-rouge">.example.com</code> is contained in the <code class="language-plaintext highlighter-rouge">host</code> variable. For example. If you visited <code class="language-plaintext highlighter-rouge">https://www.example.com</code>, the <code class="language-plaintext highlighter-rouge">host</code> variable would equal <code class="language-plaintext highlighter-rouge">www.example.com</code>. Your traffic would be sent directly to the internet because the <code class="language-plaintext highlighter-rouge">host</code> variable contains the string <code class="language-plaintext highlighter-rouge">.example.com</code>.</p><p>Sometimes a URL contains a simple domain name, such as <code class="language-plaintext highlighter-rouge">example.com</code>. This would not match <code class="language-plaintext highlighter-rouge">.example.com</code> and the traffic would be proxied. This can be resolved by adding an additional entry for the plain domain name. However, <code class="language-plaintext highlighter-rouge">dnsDomainIs(host, "example.com")</code> would also match <code class="language-plaintext highlighter-rouge">xxxexample.com</code>. As you can imagine, that would be a problem, so be careful using this method. A more efficient way would be to prepend the dot to every hostname, as we mentioned above, with <code class="language-plaintext highlighter-rouge">host = "."+host.toLowerCase();</code>. This allows you to always enter domains in the same fashion, such as <code class="language-plaintext highlighter-rouge">dnsDomainIs(host, ".example.com")</code>.</p><p>When matching a subdomain, you’ll almost never want to provide a leading dot in your test. This is because doing so would require something preceeding it. For example:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nx">host</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">sub.example.com</span><span class="dl">"</span>
<span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">.sub.example.com</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// Does NOT match</span>
<span class="nf">dnsDomainIs</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="dl">"</span><span class="s2">sub.example.com</span><span class="dl">"</span><span class="p">)</span>  <span class="c1">// Does match</span>
</pre></table></code></div></div><p>You would only want to add a leading dot if you expected something to always preceed it, such as <code class="language-plaintext highlighter-rouge">pre.sub.example.com</code>.</p><p>Remember, <strong>never</strong> add path information to <code class="language-plaintext highlighter-rouge">dnsDomainIs()</code>, or any other function that references the <code class="language-plaintext highlighter-rouge">host</code> variable. It will <strong>never</strong> result in the desired outcome. As mentioned earlier, as of Chrome version 75, path information isn’t even included in the <code class="language-plaintext highlighter-rouge">url</code> variable.</p><hr /><h3 id="send-all-other-traffic-to-proxy"><span class="me-2">Send All Other Traffic to PROXY</span><a href="#send-all-other-traffic-to-proxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="cm">/* Default Traffic Forwarding. */</span>
<span class="k">return</span> <span class="dl">"</span><span class="s2">PROXY node1.example.com:9443; PROXY node2.example.com:9443</span><span class="dl">"</span><span class="p">;</span>
</pre></table></code></div></div><p>This final block sends all traffic that wasn’t matched above to the proxy server. These are prioritized from left to right. If the first server is unreachable, the second is used.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/pac-files/">PAC Files</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/pacfiles/" class="post-tag no-text-decoration" >pacfiles</a> <a href="/tags/zscaler/" class="post-tag no-text-decoration" >zscaler</a> <a href="/tags/filtering/" class="post-tag no-text-decoration" >filtering</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PAC%20File%20Syntax%20Explained%20-%20MCNC%20CNE&url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fpac-file-syntax-explained%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PAC%20File%20Syntax%20Explained%20-%20MCNC%20CNE&u=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fpac-file-syntax-explained%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fpac-file-syntax-explained%2F&text=PAC%20File%20Syntax%20Explained%20-%20MCNC%20CNE" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmcnc-clovett.github.io%2Fposts%2Fpac-file-syntax-explained%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/enterprise-sub-ca/">Creating an Enterprise Subordinate CA from an Offline Root CA</a><li class="text-truncate lh-lg"> <a href="/posts/ssl_certificate_management/">SSL Certificate Management</a><li class="text-truncate lh-lg"> <a href="/posts/offline-linux-ca/">Offline Root Certificate Authority - Linux</a><li class="text-truncate lh-lg"> <a href="/posts/allowing-wifi-calling/">Allowing Wifi Calling</a><li class="text-truncate lh-lg"> <a href="/posts/create-domain-join-account/">Creating a Domain Join Account in AD</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/pac-file-tips-n-tricks/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1608004800" data-df="ll" > Dec 14, 2020 </time><h4 class="pt-0 my-2">PAC File Tips & Tricks</h4><div class="text-muted"><p>Lets try to clear up some common questions and issues with PAC files Understand what the “url” and “host” variables are You will always see the following on the top line of a PAC file function...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/pac-file-tips-n-tricks/" class="btn btn-outline-primary" aria-label="Older" ><p>PAC File Tips & Tricks</p></a> <a href="/posts/powershell-script-signing/" class="btn btn-outline-primary" aria-label="Newer" ><p>PowerShell Script Signing</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2024</time> <a href="https://github.com/mcnc-clovett">Chris Lovett</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.0" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/certificate/">certificate</a> <a class="post-tag btn btn-outline-primary" href="/tags/networking/">networking</a> <a class="post-tag btn btn-outline-primary" href="/tags/encryption/">encryption</a> <a class="post-tag btn btn-outline-primary" href="/tags/gnupg/">gnupg</a> <a class="post-tag btn btn-outline-primary" href="/tags/gpg/">gpg</a> <a class="post-tag btn btn-outline-primary" href="/tags/pgp/">pgp</a> <a class="post-tag btn btn-outline-primary" href="/tags/active-directory/">active directory</a> <a class="post-tag btn btn-outline-primary" href="/tags/ssh/">ssh</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
